# Phase 4: Time Slot Booking Flow - Visual Guide

## Overall Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ADMIN PANEL                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Create Schedule for Date (e.g., 2024-01-20)             â”‚  â”‚
â”‚  â”‚   â”œâ”€ Time Slot 1: Session A, 10:00-11:00                 â”‚  â”‚
â”‚  â”‚   â”œâ”€ Time Slot 2: Session B, 11:00-12:00                 â”‚  â”‚
â”‚  â”‚   â””â”€ Time Slot 3: Session A, 14:00-15:00                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATABASE - SCHEDULES                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Schedule ID: 100                                           â”‚  â”‚
â”‚  â”‚ Date: 2024-01-20                                           â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ ScheduleTimeSlot (100-1): Session A, 10:00-11:00         â”‚  â”‚
â”‚  â”‚ ScheduleTimeSlot (100-2): Session B, 11:00-12:00         â”‚  â”‚
â”‚  â”‚ ScheduleTimeSlot (100-3): Session A, 14:00-15:00         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLIENT DASHBOARD                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  All Upcoming Sessions (3)                                â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ“— Session A                                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ Category: Yoga | Duration: 60 min                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ Trainer: John Smith                                  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ Date: Jan 20, 2024                                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ Time: 10:00 - 11:00                                  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ [Book Now]                                           â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ“˜ Session B                                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ Category: Pilates | Duration: 45 min                â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ Trainer: Jane Doe                                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ Date: Jan 20, 2024                                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ Time: 11:00 - 12:00                                  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ [Book Now]                                           â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ“— Session A                                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ Category: Yoga | Duration: 60 min                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ Trainer: John Smith                                  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ Date: Jan 20, 2024                                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ Time: 14:00 - 15:00                                  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ [Book Now]                                           â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚                    â”‚                    â”‚
   â”‚ Click             â”‚ Click              â”‚ Click
   â”‚ "Book Now"        â”‚ "Book Now"         â”‚ "Book Now"
   â–¼                   â–¼                    â–¼
/time-slot/101/book  /time-slot/102/book  /time-slot/103/book
```

## Booking Flow - Phase 4 (Time Slot Based)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BOOKING MODAL OPENED                          â”‚
â”‚           /time-slot/{slot_id}/book                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BookingFlow Component Init                           â”‚
â”‚                                                                   â”‚
â”‚  Props: initialTimeSlotId = {slot_id}                            â”‚
â”‚                                                                   â”‚
â”‚  1. Fetch all schedules                                          â”‚
â”‚  2. Find schedule containing time slot {slot_id}                 â”‚
â”‚  3. Extract time slot details:                                   â”‚
â”‚     - Session: Yoga (60 min)                                     â”‚
â”‚     - Trainer: John Smith                                        â”‚
â”‚     - Time: 10:00 - 11:00                                        â”‚
â”‚     - Date: Jan 20, 2024                                         â”‚
â”‚  4. Set step = 'chooseBookingMethod' (SKIP date/class selection) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            STEP: CHOOSE BOOKING METHOD                           â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                             â”‚                              â”‚  â”‚
â”‚  â”‚  Show Time Slot Details:    â”‚  Show Time Slot Details:    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ Session: Yoga          â”‚ â”‚  â”‚ Session: Yoga          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ Time: 10:00 - 11:00    â”‚ â”‚  â”‚ Time: 10:00 - 11:00    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ Date: Jan 20, 2024     â”‚ â”‚  â”‚ Date: Jan 20, 2024     â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                             â”‚                              â”‚  â”‚
â”‚  â”‚  [âœ… My Account]            â”‚  [ğŸ‘¤ Book as Guest]         â”‚  â”‚
â”‚  â”‚  Book using registered      â”‚  No account needed.         â”‚  â”‚
â”‚  â”‚  account (if logged in)     â”‚  Just provide contact info  â”‚  â”‚
â”‚  â”‚                             â”‚                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  [Continue] â†’ (proceeds to payment reference step)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            STEP: ENTER BOOKING DETAILS                           â”‚
â”‚                                                                   â”‚
â”‚  IF Registered User:                                             â”‚
â”‚  â”œâ”€ Name: John Doe (from token)                                 â”‚
â”‚  â””â”€ Email: john@example.com (from token)                        â”‚
â”‚                                                                   â”‚
â”‚  IF Guest:                                                       â”‚
â”‚  â”œâ”€ [Name]  ___________________________                          â”‚
â”‚  â”œâ”€ [Email] ___________________________                          â”‚
â”‚  â””â”€ [Phone] ___________________________                          â”‚
â”‚                                                                   â”‚
â”‚  Payment Reference (Optional):                                   â”‚
â”‚  â””â”€ [Reference] ___________________________                      â”‚
â”‚                                                                   â”‚
â”‚  [Complete Booking]                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   API CALL: CREATE BOOKING                       â”‚
â”‚                                                                   â”‚
â”‚  POST /bookings                                                  â”‚
â”‚  {                                                                â”‚
â”‚    "time_slot_id": 101,           â† PRIMARY KEY (new)           â”‚
â”‚    "user_id": 123,                â† if registered               â”‚
â”‚    "guest_name": "John Doe",      â† if guest                    â”‚
â”‚    "guest_email": "john@...",     â† if guest                    â”‚
â”‚    "guest_phone": "555-1234",     â† if guest                    â”‚
â”‚    "payment_reference": "REF123"                                 â”‚
â”‚  }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  BACKEND: BOOKING SERVICE                        â”‚
â”‚                                                                   â”‚
â”‚  1. Fetch ScheduleTimeSlot (101)                                 â”‚
â”‚     - Relations: [schedule, session]                             â”‚
â”‚     - Result: TimeSlot with Schedule & Session loaded            â”‚
â”‚                                                                   â”‚
â”‚  2. Extract schedule and session from time slot                  â”‚
â”‚     - Schedule: ID 100, Date: 2024-01-20                         â”‚
â”‚     - Session: Yoga, Capacity: 20, Trainer: John Smith           â”‚
â”‚                                                                   â”‚
â”‚  3. Check capacity:                                              â”‚
â”‚     - Current bookings for this time slot: 18                    â”‚
â”‚     - Can still book: YES (20 - 18 = 2 spots)                    â”‚
â”‚                                                                   â”‚
â”‚  4. Create booking:                                              â”‚
â”‚     {                                                             â”‚
â”‚       booking_id: 456,                                           â”‚
â”‚       time_slot_id: 101,          â† LINKED TO TIME SLOT        â”‚
â”‚       schedule_id: 100,           â† DENORMALIZED               â”‚
â”‚       user_id: 123,                                              â”‚
â”‚       status: "booked",                                          â”‚
â”‚       date_booked: "2024-01-15T10:30:00Z"                       â”‚
â”‚     }                                                             â”‚
â”‚                                                                   â”‚
â”‚  5. Save to database                                             â”‚
â”‚                                                                   â”‚
â”‚  6. Return booking response                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  CLIENT: SUCCESS & REDIRECT                      â”‚
â”‚                                                                   â”‚
â”‚  âœ… Booking created #456                                         â”‚
â”‚  âœ… Modal closes                                                 â”‚
â”‚  âœ… Redirected back to dashboard                                 â”‚
â”‚                                                                   â”‚
â”‚  Dashboard now shows:                                            â”‚
â”‚  "Upcoming Sessions (1)"                                         â”‚
â”‚  â”œâ”€ Session: Yoga                                                â”‚
â”‚  â”œâ”€ Trainer: John Smith                                          â”‚
â”‚  â”œâ”€ Date: Jan 20, 2024                                           â”‚
â”‚  â”œâ”€ Time: 10:00 - 11:00                                          â”‚
â”‚  â””â”€ Status: [booked] âœ…                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Model Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    SCHEDULE      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ schedule_id  PK  â”‚
â”‚ date         DB  â”‚
â”‚ created_by   FK  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1
         â”‚ Oâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                            â”‚
         â”‚ (One-to-Many)              â”‚
         â”‚                            â”‚
         â–¼ M                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   SCHEDULE_TIME_SLOT         â”‚     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚ slot_id              PK       â”‚     â”‚
â”‚ schedule_id          FK   â—„â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”˜
â”‚ session_id           FK   â—„â”€â”€â”€â”
â”‚ start_time           TIME     â”‚
â”‚ end_time             TIME     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
         â”‚ 1                         â”‚
         â”‚                           â”‚
         â”‚ Oâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”
         â”‚ (Many-to-One)              â”‚    â”‚
         â”‚                       â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
         â”‚                       â”‚    SESSION     â”‚
         â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â–¼ M                      â”‚ session_id PK  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ title          â”‚
â”‚        BOOKING               â”‚ â”‚ category       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ duration_min    â”‚
â”‚ booking_id           PK       â”‚ â”‚ capacity       â”‚
â”‚ time_slot_id         FK   â—„â”€â”€â”€â”¤ â”‚ trainer_id FK  â”‚
â”‚ schedule_id          FK       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ user_id              FK       â”‚
â”‚ group_id             FK       â”‚
â”‚ guest_name           VARCHAR  â”‚
â”‚ guest_email          VARCHAR  â”‚
â”‚ payment_reference    VARCHAR  â”‚
â”‚ date_booked          DATETIME â”‚
â”‚ status               ENUM     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Data Flows

### Admin Creates Schedule with Time Slots

```
AdminSchedulesPage
  â†’ Form: date, [timeSlots]
    â†’ timeSlot 1: session A, 10:00, 11:00
    â†’ timeSlot 2: session B, 11:00, 12:00
    â†’ timeSlot 3: session A, 14:00, 15:00
  â†’ API: POST /schedules { date, timeSlots: [...] }
  â†’ Backend: ScheduleService.create()
    â†’ Save Schedule with date
    â†’ Save 3 ScheduleTimeSlot records
  â†’ Database:
    â†’ INSERT schedules (schedule_id=100, date='2024-01-20')
    â†’ INSERT schedule_time_slots (slot_id=101, schedule_id=100, session_id=1, start_time='10:00', end_time='11:00')
    â†’ INSERT schedule_time_slots (slot_id=102, schedule_id=100, session_id=2, start_time='11:00', end_time='12:00')
    â†’ INSERT schedule_time_slots (slot_id=103, schedule_id=100, session_id=1, start_time='14:00', end_time='15:00')
```

### Client Views Upcoming Sessions

```
ClientDashboard
  â†’ API: GET /dashboard/client
  â†’ Backend: Returns schedules with timeSlots eager-loaded
  â†’ Frontend: Loop through schedules
    â†’ For each schedule, loop through timeSlots
    â†’ Display each timeSlot as separate booking option
    â†’ Each has [Book Now] â†’ /time-slot/{slot_id}/book
  â†’ Display:
    â†’ TimeSlot 101: Session A, 10:00-11:00, [Book Now]
    â†’ TimeSlot 102: Session B, 11:00-12:00, [Book Now]
    â†’ TimeSlot 103: Session A, 14:00-15:00, [Book Now]
```

### Client Books Specific Time Slot

```
Click [Book Now] on TimeSlot 101
  â†’ Navigate to /time-slot/101/book
  â†’ BookingModal receives slot_id=101
  â†’ BookingFlow init with initialTimeSlotId=101
  â†’ Fetch schedules
  â†’ Find schedule+timeSlot matching slot_id=101
  â†’ Set selectedTimeSlot + selectedSchedule
  â†’ Show chooseBookingMethod step
  â†’ User selects registered/guest
  â†’ User enters details (if guest)
  â†’ Click [Complete Booking]
  â†’ API: POST /bookings { time_slot_id: 101, user_id: 123, ... }
  â†’ Backend: BookingsService.create()
    â†’ Fetch ScheduleTimeSlot(101) with relations
    â†’ Get capacity from timeSlot.session
    â†’ Check bookings count for this slot
    â†’ If capacity OK: Create booking
    â†’ Set booking.time_slot_id = 101
    â†’ Set booking.schedule_id = 100 (denormalized)
    â†’ Save booking
  â†’ Database:
    â†’ INSERT bookings (
        booking_id=456,
        time_slot_id=101,
        schedule_id=100,
        user_id=123,
        status='booked'
      )
  â†’ Response: Success
  â†’ ClientDashboard updates
    â†’ Booking appears in "Upcoming Sessions"
```

## State Management in BookingFlow

```
Initial State:
â”œâ”€ step: 'pickDate'
â”œâ”€ selectedDate: null
â”œâ”€ selectedSchedule: null
â”œâ”€ selectedTimeSlot: null
â”œâ”€ bookingMethod: null
â””â”€ ...

With initialTimeSlotId:
1. useEffect runs
2. Fetches schedules
3. Finds matching time slot
4. Sets selectedTimeSlot: { slot_id, session, ... }
5. Sets selectedSchedule: { schedule_id, date, ... }
6. Sets step: 'chooseBookingMethod' (SKIPS date/class selection)

State after method selection:
â”œâ”€ step: 'chooseBookingMethod'
â”œâ”€ bookingMethod: 'registered' | 'guest'
â”œâ”€ selectedTimeSlot: { slot_id: 101, session, start_time, end_time }
â”œâ”€ selectedSchedule: { schedule_id: 100, date: '2024-01-20' }
â””â”€ (If guest) guestName, guestEmail, guestPhone filled

On booking completion:
â”œâ”€ payload: { time_slot_id: 101, user_id: 123 } (or guest fields)
â”œâ”€ API call: POST /bookings
â””â”€ Success: Close modal, return to dashboard
```

## Summary

Phase 4 transforms booking from schedule-wide to time-slot-specific:

**Before Phase 4:**

- One booking per schedule
- Schedule = one time slot = one session
- Clients book entire schedule

**After Phase 4:**

- Multiple time slots per schedule
- Multiple sessions per day
- Each slot bookable independently
- Clients choose specific slot
- Better capacity management
- More flexibility for trainers

âœ… **Result:** Google Calendar-like booking experience where clients see and select specific time slots.
