@url=https://atara-dajy.onrender.com
@adminToken=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjMsInJvbGUiOiJhZG1pbiIsImlhdCI6MTc2MzQ2MTYzNCwiZXhwIjoxNzYzNDY1MjM0fQ.JtEJkn4K8TWlBIRRrx8BHyd-4qNKSeNTy-YXjcJCmYk
@trainerToken=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjI1LCJyb2xlIjoidHJhaW5lciIsImlhdCI6MTc2MzQ1ODMwMywiZXhwIjoxNzYzNDYxOTAzfQ.OEKcksWNNqI2LA6waRDqHtbdqLhjU_0skRvIvNUNjUw
@clientToken=PASTE_CLIENT_TOKEN_HERE

##Sign up an admin user
POST https://atara-dajy.onrender.com/auth/register
Content-Type: application/json

{
    "username": "atara",
    "email": "atara@gmail.com",
    "phone": "0791525442",
    "password": "blessedwell25",
    "role": "admin",
    "status": "active"
}

###Sign up a trainer
POST https://atara-dajy.onrender.com/auth/register
Content-Type: application/json

{
    "username": "Jane Doe",
    "email": "jane@trainer.com",
    "phone": "+1234567890",
    "password": "JaneDoe",
    "role": "trainer",
    "status": "active"
}

###Sign up a manager
POST https://atara-dajy.onrender.com/auth/register
Content-Type: application/json

{
    "username": "victry",
    "email": "atarastudio25@gmail.com",
    "phone": "0716914453",
    "password": "Manager1",
    "role": "manager",
    "status": "active"
}

###Sign up a client (default)
POST https://atara-dajy.onrender.com/auth/register
Content-Type: application/json

{
    "username": "clientuser",
    "email": "client@gmail.com",
    "phone": "0755555555",
    "password": "Client@1234",
    "role": "client",
    "status": "active"
}

###Login - Admin User
POST https://atara-dajy.onrender.com/auth/login
Content-Type: application/json

{
    "email": "aquinatta@gmail.com",
    "password": "Akwinara2005!"
}

###Login - Trainer User
POST https://atara-dajy.onrender.com/auth/login
Content-Type: application/json

{
    "email": "john@gmail.com",
    "password": "JohnDoe"
}

###Login - Manager User
POST https://atara-dajy.onrender.com/auth/login
Content-Type: application/json

{
    "email": "manager@gmail.com",
    "password": "Manager!"
}

###Login - Client User
POST https://atara-dajy.onrender.com/auth/login
Content-Type: application/json

{
    "email": "client@gmail.com",
    "password": "Client@1234"
}

###Get all users (requires authorization)
### Use the access_token from any login response above
GET https://atara-dajy.onrender.com/users
Authorization: Bearer {{adminToken}}

###Get one user by ID (requires authorization)
GET https://atara-dajy.onrender.com/users/4
Authorization: Bearer {{adminToken}}

###Remove user by ID (requires authorization)
DELETE https://atara-dajy.onrender.com/users/6
Authorization: Bearer {{adminToken}}

###Update user by ID (requires authorization)
PATCH https://atara-dajy.onrender.com/users/3
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
    "role": "trainer"
}

### Test Dashboard Endpoints
### IMPORTANT: Replace {{trainerToken}} with actual trainer JWT token from login response

### 1. Login as trainer (get token)
### Copy the access_token from response and use below
POST https://atara-dajy.onrender.com/auth/login
Content-Type: application/json

{
    "email": "ataratrainer@gmail.com",
    "password": "Trainer@1234"
}

### 2. Test Trainer Dashboard Endpoint
### This should return: trainer, sessions, upcomingSchedules, bookings, cancellations, stats
GET https://atara-dajy.onrender.com/dashboard/trainer
Authorization: Bearer {{trainerToken}}

### 3. Get Trainer Profile (trainers/:id endpoint)
### Replace ID with actual trainer ID from dashboard response
GET https://atara-dajy.onrender.com/trainers/1
Authorization: Bearer {{trainerToken}}

### 4. Get All Trainers (PUBLIC - no auth required)
GET https://atara-dajy.onrender.com/trainers
Authorization: Bearer {{adminToken}}

### 4a. Get All Trainers (ADMIN ENDPOINT - requires admin token)
### This is what the dashboard uses - must use {{adminToken}}
GET https://atara-dajy.onrender.com/admin/trainers?page=1&limit=100
Authorization: Bearer {{adminToken}}

### 4b. Create New Trainer (ADMIN ONLY - NEW ENDPOINT!)
### This is the new POST endpoint added to fix the issue
POST https://atara-dajy.onrender.com/admin/trainers
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
    "user_id": 11,
    "name": "Jane Doe",
    "specialty": "yoga",
    "phone": "+1234567890",
    "email": "jane@trainer.com",
    "bio": "Experienced yoga instructor with 10 years of teaching",
    "status": "active"
}

### 5. Get All Sessions
### Should show all sessions (for reference)
GET https://atara-dajy.onrender.com/sessions
Authorization: Bearer {{trainerToken}}

### Create a session (for testing bookings)
POST https://atara-dajy.onrender.com/sessions
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
    "trainer_id": 1,
    "category": "yoga",
    "description": "A refreshing morning yoga session",
    "date": "2024-07-01",
    "time": "08:00:00",
    "duration": 60,
    "capacity": 15,
    "status": "active"
}

### 6. Get All Bookings
### Should show all bookings (for reference)
GET https://atara-dajy.onrender.com/bookings
Authorization: Bearer {{trainerToken}}

### 7. Get All Schedules
GET https://atara-dajy.onrender.com/schedule
Authorization: Bearer {{trainerToken}}

### 8. Test Client Dashboard (for comparison)
### Login as client first and get token
POST https://atara-dajy.onrender.com/auth/login
Content-Type: application/json

{
    "email": "client@gmail.com",
    "password": "Client@1234"
}

### Then test client dashboard
GET https://atara-dajy.onrender.com/dashboard/client
Authorization: Bearer {{clientToken}}

### 9. Test Health Check
### Simple endpoint to verify server is responding
GET https://atara-dajy.onrender.com/

### 10. DEBUG: Check Admin User Role
### This endpoint tells you what role the token has
GET https://atara-dajy.onrender.com/admin/debug/whoami
Authorization: Bearer {{adminToken}}

### 10a. FIX: Create Notifications Table
### This will create the missing notifications table
POST https://atara-dajy.onrender.com/admin/debug/fix-notifications
Authorization: Bearer {{adminToken}}

### 11. TEST: Create Multiple Schedules on Same Day
### First Schedule - Morning Session
POST https://atara-dajy.onrender.com/admin/schedules
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "session_id": 1,
  "start_time": "2024-11-05T08:00:00Z",
  "end_time": "2024-11-05T09:00:00Z"
}

### 11b. TEST: Create Second Schedule on Same Day - Noon
### This should work without any conflicts
POST https://atara-dajy.onrender.com/admin/schedules
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "session_id": 1,
  "start_time": "2024-11-05T12:00:00Z",
  "end_time": "2024-11-05T13:00:00Z"
}

### 11c. TEST: Create Third Schedule on Same Day - Evening
### Admin can create as many as needed on one day
POST https://atara-dajy.onrender.com/admin/schedules
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "session_id": 1,
  "start_time": "2024-11-05T17:00:00Z",
  "end_time": "2024-11-05T18:00:00Z"
}

### 12. Get All Schedules (to verify multiple schedules created)
GET https://atara-dajy.onrender.com/admin/schedules
Authorization: Bearer {{adminToken}}

### TROUBLESHOOTING GUIDE:
### If you get 404 on /dashboard/trainer:
###   - Check that backend is running on port 3000
###   - Verify ServeStaticModule exclude patterns are correct
###   - Restart backend server
###
### If you get 403 Forbidden on /dashboard/trainer:
###   - Verify token is from a trainer account (role: "trainer")
###   - Check that token is still valid (not expired)
###
### If you get 500 error on /dashboard/trainer:
###   - Check backend console for error details
###   - Verify trainer profile exists (user_id matches)
###   - Check database connection

### MULTIPLE SCHEDULES PER DAY GUIDE:
### The system fully supports creating multiple schedules on the same day.
### There are NO restrictions on:
###   - Number of schedules per day
###   - Time conflicts between schedules
###   - Duplicate session_id values
###
### The only requirement is:
###   - start_time must be before end_time
###   - session_id must exist
###
### Use cases:
###   - Create morning, noon, and evening sessions on same day
###   - Multiple trainers leading different sessions same day
###   - Different session types (yoga, pilates, strength) same day
###   - Fully flexible scheduling based on business needs

### 13. FINAL VERIFICATION: Get All 5 Requirements Working
### Test the complete implementation of all 5 features

### Feature 1: Get Client Dashboard (should include upcomingSchedules)
POST https://atara-dajy.onrender.com/auth/login
Content-Type: application/json

{
    "email": "client@gmail.com",
    "password": "Client@1234"
},
    "password": "Client@1234"
}

### Save the token and use in next request
### GET https://atara-dajy.onrender.com/dashboard/client
### Expected: upcomingSchedules array with all schedules

### EXPENSES ENDPOINTS
### Admin can create expenses, both admin and manager can view/update status

### Get all expenses (Admin/Manager only)
GET https://atara-dajy.onrender.com/admin/expenses?page=1&limit=10
Authorization: Bearer {{adminToken}}

### Get expense totals (Admin/Manager only)
GET https://atara-dajy.onrender.com/admin/expenses/totals
Authorization: Bearer {{adminToken}}

### Create new expense (Admin only)
POST https://atara-dajy.onrender.com/admin/expenses
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
    "name": "Office Supplies",
    "date": "2024-01-15",
    "cost": 150.75,
    "status": "approved"
}

### Update expense status (Admin/Manager)
PATCH https://atara-dajy.onrender.com/admin/expenses/1/status
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
    "status": "cancelled"
}

### EXPENSES ENDPOINTS
### Admin can create expenses, both admin and manager can view/update status

### Get all expenses (Admin/Manager only)
GET https://atara-dajy.onrender.com/admin/expenses?page=1&limit=10
Authorization: Bearer {{adminToken}}

### Get expense totals (Admin/Manager only)
GET https://atara-dajy.onrender.com/admin/expenses/totals
Authorization: Bearer {{adminToken}}

### Create new expense (Admin only)
POST https://atara-dajy.onrender.com/admin/expenses
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
    "name": "Office Supplies",
    "date": "2024-01-15",
    "cost": 150.75,
    "status": "approved"
}

### Update expense status (Admin/Manager)
PATCH https://atara-dajy.onrender.com/admin/expenses/1/status
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
    "status": "cancelled"
}
### Authorization: Bearer {{clientToken}}
### Expected: upcomingSchedules array with all schedules
### Expected: upcomingSchedules array with all schedules

### Feature 2: Verify Multiple Schedules Same Day
### Create 3 schedules on same day - all should succeed
### POST requests 11, 11b, 11c above

### Feature 3: Get Carousel Images
GET http://localhost:3000/

### BOOKING WITH PAYMENT REFERENCE TESTS
### These endpoints test the updated booking workflow

### 1. Create guest booking with required name, phone, and payment reference
POST http://localhost:3000/bookings
Content-Type: application/json

{
    "time_slot_id": 1,
    "guest_name": "John Doe",
    "guest_phone": "+1234567890",
    "guest_email": "john@example.com",
    "payment_reference": "PAY-123456789"
}

### 2. Try to create guest booking without required fields (should fail)
POST http://localhost:3000/bookings
Content-Type: application/json

{
    "time_slot_id": 1,
    "guest_email": "incomplete@example.com"
}

### 3. Create registered user booking with payment reference
POST http://localhost:3000/bookings
Authorization: Bearer {{clientToken}}
Content-Type: application/json

{
    "time_slot_id": 1,
    "user_id": 1,
    "payment_reference": "CONF-987654321"
}

### 4. Admin confirms booking with payment reference validation
PATCH http://localhost:3000/admin/bookings/1/status
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
    "status": "booked",
    "payment_reference": "VERIFIED-PAY-123456789"
}

### 5. Get all bookings to see guest info and payment references
GET http://localhost:3000/admin/bookings
Authorization: Bearer {{adminToken}}

### TRAINER FUNCTIONALITY TESTS
### These endpoints test trainer-specific features

### 1. Get trainer's sessions (My Sessions)
GET http://localhost:3000/dashboard/trainer/sessions
Authorization: Bearer {{trainerToken}}

### 2. Get trainer's student bookings (Student Bookings)
GET http://localhost:3000/dashboard/trainer/bookings
Authorization: Bearer {{trainerToken}}

### 3. Upload trainer profile image
### Use multipart/form-data with 'image' field
POST http://localhost:3000/trainers/1/upload-image
Authorization: Bearer {{trainerToken}}
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="image"; filename="trainer.jpg"
Content-Type: image/jpeg

[Binary image data would go here]
------WebKitFormBoundary7MA4YWxkTrZu0gW--

### 4. Get trainer profile with image
GET http://localhost:3000/trainers/1
Authorization: Bearer {{trainerToken}}

### 5. Get public trainers list (should not show phone numbers)
GET http://localhost:3000/trainerscalhost:3000/

### BOOKING PAYMENT REFERENCE CONFIRMATION TESTS
### These endpoints test the payment reference confirmation workflow

### 1. Update booking status to 'booked' (confirmed) with payment reference
### This requires both status and payment_reference fields
PATCH http://localhost:3000/admin/bookings/1/status
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
    "status": "booked",
    "payment_reference": "PAY-123456789"
}

### 2. Update booking status to 'cancelled' (no payment reference needed)
PATCH http://localhost:3000/admin/bookings/1/status
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
    "status": "cancelled"
}

### 3. Update booking status to 'completed' (awards loyalty points)
PATCH http://localhost:3000/admin/bookings/1/status
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
    "status": "completed"
}

### 4. Try to confirm booking without payment reference (should fail)
PATCH http://localhost:3000/admin/bookings/1/status
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
    "status": "booked"
}

### 5. Confirm payment using dedicated endpoint (alternative method)
PATCH http://localhost:3000/admin/bookings/1/confirm-payment
Authorization: Bearer {{adminToken}}

### PAYMENT CONFIRMATION ENDPOINTS (ADMIN ONLY)

### Get all bookings (admin view)
GET https://atara-dajy.onrender.com/admin/bookings
Authorization: Bearer {{adminToken}}

### Confirm payment reference for a booking
### Replace :id with actual booking ID
PATCH https://atara-dajy.onrender.com/admin/bookings/1/confirm-payment
Authorization: Bearer {{adminToken}}

### Update booking status (existing endpoint)
### Replace :id with actual booking ID
PATCH https://atara-dajy.onrender.com/admin/bookings/1/status
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
    "status": "completed"
}

### TRAINER PROFILE IMAGE UPLOAD

### Upload trainer profile image (trainer can upload their own, admin can upload any)
### Replace :id with actual trainer ID
### NOTE: This requires multipart/form-data with 'image' field
POST https://atara-dajy.onrender.com/trainers/3/upload-image
Authorization: Bearer {{trainerToken}}
Content-Type: multipart/form-data

### Get trainer with profile image (public endpoint)
GET https://atara-dajy.onrender.com/trainers/3

### Access uploaded image (public)
### GET https://atara-dajy.onrender.com/images/trainers/trainer-123456789.jpg00/slides
### Expected: Array of 3 Unsplash image URLs

### Feature 4: Check Responsive Session Card
### View on mobile viewport - should display correctly
### Click Book Now button - should redirect to /sessions/booking

### Feature 5: Verify KES Currency
### Check any session response
### Expected price format: "KES 2000" not "$20.00"


### EXPENSES ENDPOINTS - Testing Real Data (No Mock Data)

### Get All Expenses (should return empty array initially)
GET https://atara-dajy.onrender.com/admin/expenses?page=1&limit=10
Authorization: Bearer {{adminToken}}

### Get Expenses Totals (should return all zeros initially)
GET https://atara-dajy.onrender.com/admin/expenses/totals
Authorization: Bearer {{adminToken}}

### Create Test Expense (Admin Only)
POST https://atara-dajy.onrender.com/admin/expenses
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
    "name": "Office Supplies",
    "date": "2024-01-15",
    "cost": 2500.00,
    "status": "approved"
}

### Update Expense Status
PATCH https://atara-dajy.onrender.com/admin/expenses/1/status
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
    "status": "cancelled"
}
### CLEAR ALL EXPENSES (Admin Only)
DELETE https://atara-dajy.onrender.com/admin/expenses/clear-all
Authorization: Bearer {{adminToken}}

### Verify Expenses Are Cleared
GET https://atara-dajy.onrender.com/admin/expenses/totals
Authorization: Bearer {{adminToken}}
### M-PESA PAYMENT INTEGRATION

### Initiate M-Pesa Payment
POST https://atara-dajy.onrender.com/mpesa/pay
Content-Type: application/json

{
    "phone_number": "254712345678",
    "amount": 500,
    "account_reference": "John Doe",
    "transaction_desc": "Yoga Session Payment"
}

### Check Payment Status
GET https://atara-dajy.onrender.com/mpesa/status/ws_CO_191220191020363925

### M-Pesa Callback (Safaricom calls this)
POST https://atara-dajy.onrender.com/mpesa/callback
Content-Type: application/json

{
    "Body": {
        "stkCallback": {
            "MerchantRequestID": "29115-34620561-1",
            "CheckoutRequestID": "ws_CO_191220191020363925",
            "ResultCode": 0,
            "ResultDesc": "The service request is processed successfully.",
            "CallbackMetadata": {
                "Item": [
                    {
                        "Name": "Amount",
                        "Value": 500
                    },
                    {
                        "Name": "MpesaReceiptNumber",
                        "Value": "NLJ7RT61SV"
                    },
                    {
                        "Name": "TransactionDate",
                        "Value": 20191219102115
                    },
                    {
                        "Name": "PhoneNumber",
                        "Value": 254712345678
                    }
                ]
            }
        }
    }
}

### CREATE NOTIFICATIONS TABLE
### Admin endpoint to create notifications table in DB
POST https://atara-dajy.onrender.com/admin/debug/fix-notifications
Authorization: Bearer {{adminToken}}

### NOTIFICATIONS TESTING

### 0. Get available time slots first
GET https://atara-dajy.onrender.com/schedule
Authorization: Bearer {{adminToken}}

### 1. Create a booking (should trigger notification to trainer)
POST https://atara-dajy.onrender.com/bookings
Content-Type: application/json

{
    "time_slot_id": 9,
    "guest_name": "Test Client",
    "guest_phone": "+1234567890",
    "guest_email": "test@example.com",
    "payment_reference": "TEST-PAY-123"
}

### 2. Get trainer notifications
GET https://atara-dajy.onrender.com/notifications
Authorization: Bearer {{trainerToken}}

### 3. Get trainer dashboard (should include notifications)
GET https://atara-dajy.onrender.com/dashboard/trainer
Authorization: Bearer {{trainerToken}}

### 4. Mark notification as read
PATCH https://atara-dajy.onrender.com/notifications/1/read
Authorization: Bearer {{trainerToken}}

### 5. Get unread notification count
GET https://atara-dajy.onrender.com/notifications/unread-count
Authorization: Bearer {{trainerToken}}